<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ExoML - Exoplanet Detection Platform</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: system-ui, sans-serif; background: #0a0a0f; color: #e0e0e0; }
.space-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%); z-index: -1; }
.stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
.star { position: absolute; background: white; border-radius: 50%; animation: twinkle 3s infinite; }
@keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
.auth-container { display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
.auth-box { background: rgba(20, 20, 30, 0.9); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; padding: 40px; width: 100%; max-width: 400px; }
.auth-box h1 { font-size: 32px; margin-bottom: 8px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.auth-box p { color: #888; margin-bottom: 30px; }
.input-group { margin-bottom: 20px; }
.input-group label { display: block; margin-bottom: 8px; font-size: 14px; color: #aaa; }
.input-group input { width: 100%; padding: 12px 16px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: #e0e0e0; font-size: 16px; }
.btn { width: 100%; padding: 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 8px; color: white; font-size: 16px; font-weight: 600; cursor: pointer; }
.btn:disabled { opacity: 0.5; cursor: not-allowed; }
.auth-toggle { text-align: center; margin-top: 20px; color: #888; }
.auth-toggle a { color: #667eea; cursor: pointer; }
.error-msg { color: #ff6b6b; font-size: 14px; margin-top: 10px; }
.app-container { display: none; height: 100vh; }
.app-container.active { display: flex; }
.sidebar { width: 280px; background: rgba(20, 20, 30, 0.95); border-right: 1px solid rgba(255, 255, 255, 0.1); display: flex; flex-direction: column; }
.sidebar-header { padding: 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
.sidebar-header h2 { font-size: 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.new-chat-btn { margin-top: 15px; width: 100%; padding: 12px; background: rgba(102, 126, 234, 0.2); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 8px; color: #667eea; cursor: pointer; font-size: 14px; font-weight: 600; }
.history { flex: 1; overflow-y: auto; padding: 20px; }
.history-item { padding: 12px; margin-bottom: 8px; background: rgba(255, 255, 255, 0.03); border-radius: 8px; cursor: pointer; font-size: 14px; }
.sidebar-footer { padding: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); }
.user-info { display: flex; align-items: center; justify-content: space-between; padding: 10px; background: rgba(255, 255, 255, 0.03); border-radius: 8px; }
.user-email { font-size: 14px; color: #aaa; }
.logout-btn { background: none; border: none; color: #888; cursor: pointer; padding: 8px; }
.main-content { flex: 1; display: flex; flex-direction: column; }
.top-bar { padding: 20px 30px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); display: flex; justify-content: space-between; background: rgba(20, 20, 30, 0.8); }
.settings-btn { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); padding: 10px 20px; border-radius: 8px; color: #e0e0e0; cursor: pointer; font-size: 14px; }
.chat-area { flex: 1; overflow-y: auto; padding: 30px; }
.welcome-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; }
.welcome-screen h1 { font-size: 48px; margin-bottom: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.welcome-screen p { font-size: 18px; color: #888; margin-bottom: 40px; }
.action-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; width: 100%; max-width: 800px; margin-top: 30px; }
.action-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 24px; cursor: pointer; transition: all 0.3s; }
.action-card:hover { background: rgba(255, 255, 255, 0.08); transform: translateY(-4px); }
.action-card h3 { font-size: 18px; margin: 16px 0 8px 0; }
.action-card p { font-size: 14px; color: #888; }
.data-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin-bottom: 20px; }
.data-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 24px; }
.data-card h3 { margin-bottom: 16px; color: #667eea; }
.chart-container { width: 100%; height: 250px; background: rgba(0,0,0,0.2); border-radius: 8px; position: relative; }
.metric { padding: 12px; background: rgba(102, 126, 234, 0.1); border-radius: 8px; margin-bottom: 8px; }
.metric-label { font-size: 12px; color: #888; }
.metric-value { font-size: 24px; font-weight: bold; color: #667eea; }
.ai-assist-btn { position: fixed; bottom: 100px; right: 40px; width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4); z-index: 100; }
.ai-assist-btn:hover { transform: scale(1.1); }
.input-area { padding: 20px 30px; border-top: 1px solid rgba(255, 255, 255, 0.1); background: rgba(20, 20, 30, 0.8); }
.input-container { display: flex; gap: 12px; max-width: 900px; margin: 0 auto; }
.upload-btn { background: rgba(102, 126, 234, 0.2); border: 1px solid rgba(102, 126, 234, 0.3); padding: 14px 18px; border-radius: 12px; color: #667eea; cursor: pointer; }
input[type="file"] { display: none; }
.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); justify-content: center; align-items: center; z-index: 1000; }
.modal.active { display: flex; }
.modal-content { background: rgba(20, 20, 30, 0.98); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; padding: 40px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; }
.modal-header { display: flex; justify-content: space-between; margin-bottom: 30px; }
.close-btn { background: none; border: none; color: #888; cursor: pointer; font-size: 24px; }
.ai-chat-area { max-height: 400px; overflow-y: auto; margin-bottom: 20px; }
.ai-message { padding: 12px; margin-bottom: 12px; border-radius: 8px; background: rgba(255,255,255,0.05); }
.ai-input { width: 100%; padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: #e0e0e0; font-size: 14px; }
.loading { text-align: center; color: #667eea; padding: 20px; }
</style>
</head>
<body>
<div class="space-bg"><div class="stars" id="stars"></div></div>

<div class="auth-container" id="authScreen">
<div class="auth-box">
<h1>ExoML</h1>
<p>NASA Exoplanet Detection with Machine Learning</p>
<form id="authForm">
<div class="input-group"><label>Email</label><input type="email" id="email" required></div>
<div class="input-group"><label>Password (min 6 characters)</label><input type="password" id="password" required></div>
<button type="submit" class="btn" id="authBtn">Sign In</button>
<div class="error-msg" id="errorMsg"></div>
</form>
<div class="auth-toggle"><span id="authToggleText">Don't have an account?</span> <a id="authToggleLink">Sign Up</a></div>
</div>
</div>

<div class="app-container" id="mainApp">
<div class="sidebar">
<div class="sidebar-header"><h2>ExoML</h2><button class="new-chat-btn" onclick="startNewChat()">+ New Analysis</button></div>
<div class="history" id="historyList"><p style="color: #666; font-size: 14px;">Your analysis history will appear here</p></div>
<div class="sidebar-footer"><div class="user-info"><span class="user-email" id="userEmail">user@example.com</span><button class="logout-btn" onclick="logout()">Logout</button></div></div>
</div>

<div class="main-content">
<div class="top-bar"><div></div><button class="settings-btn" onclick="openSettings()">Settings</button></div>
<div class="chat-area">
<div class="welcome-screen" id="welcomeScreen">
<h1>ExoML</h1>
<p>NASA-Grade Exoplanet Detection System</p>
<div class="action-cards">
<div class="action-card" onclick="document.getElementById('fileInput').click()"><h3>üìä Upload Data</h3><p>Analyze transit photometry CSV files</p></div>
<div class="action-card" onclick="openAIAssist()"><h3>ü§ñ AI Assistant</h3><p>Ask questions about ML predictions</p></div>
<div class="action-card" onclick="openSettings()"><h3>‚öôÔ∏è Model Info</h3><p>View configuration and metrics</p></div>
</div>
</div>
<div id="dataContainer"></div>
</div>
<div class="input-area">
<div class="input-container">
<button class="upload-btn" onclick="document.getElementById('fileInput').click()">üìé Upload CSV</button>
</div>
</div>
</div>
</div>

<button class="ai-assist-btn" onclick="openAIAssist()" title="AI Assistance">ü§ñ</button>

<div class="modal" id="aiModal">
<div class="modal-content">
<div class="modal-header"><h2>AI Assistant</h2><button class="close-btn" onclick="closeAIAssist()">√ó</button></div>
<div class="ai-chat-area" id="aiChatArea">
<p style="color: #888;">Ask me about the ML model predictions, exoplanet characteristics, or data analysis!</p>
</div>
<input type="text" class="ai-input" id="aiInput" placeholder="Ask about the ML model results..." onkeypress="if(event.key==='Enter')sendAIMessage()">
<button class="btn" style="margin-top: 12px;" onclick="sendAIMessage()">Send</button>
</div>
</div>

<div class="modal" id="settingsModal">
<div class="modal-content">
<div class="modal-header"><h2>Model Configuration</h2><button class="close-btn" onclick="closeSettings()">√ó</button></div>
<div class="setting-item"><label>Model Status</label><input type="text" value="NASA Exoplanet ML Model v1.0" disabled style="opacity: 0.7; width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: #e0e0e0;"></div>
<div class="setting-item" style="margin-top: 20px;"><label>Dataset</label><input type="text" value="NASA Exoplanet Archive" disabled style="opacity: 0.7; width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: #e0e0e0;"></div>
<div class="setting-item" style="margin-top: 20px;"><label>API Endpoint</label><input type="text" id="apiEndpoint" placeholder="Auto-detected (localhost or Vercel)" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: #e0e0e0;"></div>
<button class="btn" onclick="closeSettings()" style="margin-top: 20px;">Close</button>
</div>
</div>

<input type="file" id="fileInput" accept=".csv" onchange="handleFileUpload(event)">

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script>
const ML_MODEL_API = 'apikey-production-b0ae.up.railway.app';

const firebaseConfig = {
  apiKey: "AIzaSyCNev9ImmiExML048xan-nY9atb6rIcghE",
  authDomain: "exomlearth.firebaseapp.com",
  projectId: "exomlearth",
  storageBucket: "exomlearth.firebasestorage.app",
  messagingSenderId: "416483624907",
  appId: "1:416483624907:web:315eaaf828f0c3319ad84e",
  measurementId: "G-105XFGY2DP"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

for(let i=0;i<200;i++){
  const s=document.createElement('div');
  s.className='star';
  s.style.left=Math.random()*100+'%';
  s.style.top=Math.random()*100+'%';
  s.style.width=Math.random()*2+1+'px';
  s.style.height=s.style.width;
  s.style.animationDelay=Math.random()*3+'s';
  document.getElementById('stars').appendChild(s);
}

let isLogin=true, currentUser=null, lastPrediction=null;

document.getElementById('authToggleLink').addEventListener('click',function(){
  isLogin=!isLogin;
  document.getElementById('authBtn').textContent=isLogin?'Sign In':'Sign Up';
  document.getElementById('authToggleText').textContent=isLogin?"Don't have an account?":'Already have an account?';
  document.getElementById('authToggleLink').textContent=isLogin?'Sign Up':'Sign In';
  document.getElementById('errorMsg').textContent='';
});

document.getElementById('authForm').addEventListener('submit',async function(e){
  e.preventDefault();
  const email=document.getElementById('email').value;
  const password=document.getElementById('password').value;
  const btn=document.getElementById('authBtn');
  const errorMsg=document.getElementById('errorMsg');
  btn.disabled=true;
  btn.textContent='Loading...';
  errorMsg.textContent='';
  try{
    if(isLogin){
      await auth.signInWithEmailAndPassword(email,password);
    }else{
      await auth.createUserWithEmailAndPassword(email,password);
    }
    currentUser={email:email};
    document.getElementById('userEmail').textContent=email;
    document.getElementById('authScreen').style.display='none';
    document.getElementById('mainApp').classList.add('active');
  }catch(error){
    errorMsg.textContent=error.message;
    btn.disabled=false;
    btn.textContent=isLogin?'Sign In':'Sign Up';
  }
});

function logout(){
  auth.signOut();
  currentUser=null;
  document.getElementById('authScreen').style.display='flex';
  document.getElementById('mainApp').classList.remove('active');
  document.getElementById('dataContainer').innerHTML='';
  document.getElementById('welcomeScreen').style.display='flex';
}

function startNewChat(){
  document.getElementById('dataContainer').innerHTML='';
  document.getElementById('welcomeScreen').style.display='flex';
  lastPrediction=null;
}

async function handleFileUpload(event){
  const file=event.target.files[0];
  if(!file)return;
  
  document.getElementById('welcomeScreen').style.display='none';
  const container=document.getElementById('dataContainer');
  container.innerHTML='<div class="loading">Analyzing data with ML model...</div>';
  
  const reader=new FileReader();
  reader.onload=async function(e){
    const csvData=e.target.result;
    try{
      // Auto-detect API endpoint: use Vercel if deployed, localhost if local
      const defaultApiUrl = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
        ? 'http://127.0.0.1:5001'
        : '/api/predict';
      const apiUrl = document.getElementById('apiEndpoint').value || defaultApiUrl;
      const response=await fetch(apiUrl,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({data:csvData})
      });
      
      if(!response.ok){
        throw new Error('ML Model API is not responding. Please check your endpoint.');
      }
      
      const prediction=await response.json();
      lastPrediction=prediction;
      displayResults(prediction, file.name);
      
      await db.collection('analyses').add({
        userId:currentUser.email,
        fileName:file.name,
        prediction:prediction,
        timestamp:firebase.firestore.FieldValue.serverTimestamp()
      });
      
      addToHistory('Analysis: '+file.name,new Date().toLocaleString());
    }catch(error){
      const currentApiUrl = document.getElementById('apiEndpoint').value || 'http://127.0.0.1:5001';
      container.innerHTML='<div class="data-card"><h3 style="color: #ff6b6b;">‚ùå Error</h3><p style="color: #888; margin-top: 12px;">'+error.message+'</p><p style="color: #666; margin-top: 8px; font-size: 14px;">Make sure your ML model server is running at: '+currentApiUrl+'</p><p style="color: #888; margin-top: 8px; font-size: 14px;">To start the server, run: <code style="background: rgba(255,255,255,0.1); padding: 2px 8px; border-radius: 4px;">python app.py</code></p></div>';
    }
  };
  reader.readAsText(file);
}

function displayResults(pred, fileName){
  const container=document.getElementById('dataContainer');
  const detected = pred.isExoplanet || pred.prediction === 1 || pred.confidence > 50;
  
  container.innerHTML=`
    <div class="data-grid">
      <div class="data-card">
        <h3>${detected ? '‚úì Exoplanet Detected' : '‚úó No Exoplanet Detected'}</h3>
        <div class="metric">
          <div class="metric-label">Confidence Score</div>
          <div class="metric-value">${pred.confidence || (pred.probability * 100).toFixed(2) || 'N/A'}%</div>
        </div>
        <div class="metric">
          <div class="metric-label">Planet Type</div>
          <div class="metric-value" style="font-size: 18px;">${pred.planetType || pred.type || 'Unknown'}</div>
        </div>
        <div class="metric">
          <div class="metric-label">File Analyzed</div>
          <div style="font-size: 14px; color: #888; margin-top: 4px;">${fileName}</div>
        </div>
      </div>
      
      <div class="data-card">
        <h3>Orbital Metrics</h3>
        <div class="metric">
          <div class="metric-label">Orbital Period</div>
          <div class="metric-value" style="font-size: 18px;">${pred.orbitalPeriod || pred.period || 'N/A'} days</div>
        </div>
        <div class="metric">
          <div class="metric-label">Temperature</div>
          <div class="metric-value" style="font-size: 18px;">${pred.temperature || pred.temp || 'N/A'} K</div>
        </div>
        <div class="metric">
          <div class="metric-label">Transit Depth</div>
          <div class="metric-value" style="font-size: 18px;">${pred.transitDepth || 'N/A'}</div>
        </div>
      </div>
    </div>
    
    <div class="data-card">
      <h3>Confidence Distribution</h3>
      <div class="chart-container">
        <canvas id="confidenceChart"></canvas>
      </div>
    </div>
    
    <div class="data-card">
      <h3>Detection Timeline</h3>
      <div class="chart-container">
        <canvas id="timelineChart"></canvas>
      </div>
    </div>
  `;
  
  createCharts(pred);
}

function createCharts(pred){
  const conf = parseFloat(pred.confidence || (pred.probability * 100) || 75);
  
  setTimeout(() => {
    new Chart(document.getElementById('confidenceChart'), {
      type: 'doughnut',
      data: {
        labels: ['Exoplanet', 'Not Exoplanet'],
        datasets: [{
          data: [conf, 100-conf],
          backgroundColor: ['#667eea', '#2a2a40']
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { labels: { color: '#e0e0e0' } }
        }
      }
    });
    
    new Chart(document.getElementById('timelineChart'), {
      type: 'line',
      data: {
        labels: ['T-5', 'T-4', 'T-3', 'T-2', 'T-1', 'T0'],
        datasets: [{
          label: 'Signal Strength',
          data: [0.2, 0.4, 0.6, 0.7, 0.8, conf/100],
          borderColor: '#667eea',
          backgroundColor: 'rgba(102, 126, 234, 0.1)',
          fill: true
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.1)' } },
          x: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.1)' } }
        },
        plugins: {
          legend: { labels: { color: '#e0e0e0' } }
        }
      }
    });
  }, 100);
}

function addToHistory(title,timestamp){
  const historyList=document.getElementById('historyList');
  if(historyList.children.length===1&&historyList.children[0].tagName==='P'){
    historyList.innerHTML='';
  }
  const item=document.createElement('div');
  item.className='history-item';
  item.innerHTML='<div style="font-weight:600;margin-bottom:4px;">'+title+'</div><div style="font-size:12px;color:#666;">'+timestamp+'</div>';
  historyList.insertBefore(item,historyList.firstChild);
}

function openAIAssist(){
  if(!lastPrediction){
    alert('Please upload and analyze data first before using AI assistance.');
    return;
  }
  document.getElementById('aiModal').classList.add('active');
}

function closeAIAssist(){
  document.getElementById('aiModal').classList.remove('active');
}

async function sendAIMessage(){
  const input=document.getElementById('aiInput');
  const msg=input.value.trim();
  if(!msg)return;
  
  const chatArea=document.getElementById('aiChatArea');
  chatArea.innerHTML+=`<div class="ai-message"><strong>You:</strong> ${msg}</div>`;
  input.value='';
  
  chatArea.innerHTML+=`<div class="ai-message"><strong>AI:</strong> <em>Analyzing...</em></div>`;
  chatArea.scrollTop=chatArea.scrollHeight;
  
  const context = lastPrediction ? `Based on the ML model prediction: ${JSON.stringify(lastPrediction)}. ` : '';
  const prompt = context + msg;
  
  setTimeout(() => {
    const lastMsg = chatArea.lastElementChild;
    lastMsg.innerHTML=`<strong>AI:</strong> To integrate a real LLM (like Claude, GPT, or Gemini), add your API key and make a fetch request to the LLM endpoint here. For now, based on your data: ${lastPrediction ? 'The model detected ' + (lastPrediction.isExoplanet ? 'an exoplanet' : 'no exoplanet') + ' with ' + (lastPrediction.confidence || '0') + '% confidence.' : 'No data available yet.'}`;
    chatArea.scrollTop=chatArea.scrollHeight;
  }, 1000);
}

function openSettings(){document.getElementById('settingsModal').classList.add('active');}
function closeSettings(){document.getElementById('settingsModal').classList.remove('active');}
</script>
</body>
</html>